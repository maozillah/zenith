<html>
	<head>
		<title>zenith</title>
		<style>
            canvas { width: 100%; height: 100% }
            body { width: 100%; height: 100%; margin: 0; padding: 0; height: 100%;
				overflow:hidden;}
            
            
            a {
                color: #fff;
                background: rgba(255, 255, 255, 0.2);
                text-decoration: none;
                padding: 15px;
                border-radius: 7px;
                text-align: center;
            }
            
            #splashscreen {
                position:absolute;
                top:0;
                left:0;
                bottom:0;
                width:100%;
                color: #fff;
                background-color:black;
            }

        </style>
	</head>
    
	<body>
        <div id="splashscreen">
       
                <h1>Zenith</h1>
                An interactive constellations view
                <br/><br/><a href="#" class="explore">Explore</a>
            
        </div>
        
		<script src="js/three.min.js"></script>
        <script src="js/Detector.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script src="js/jquery-csv.min.js"></script>
		<script>
            var scene, camera, renderer;
            var starData;
            
            $( document ).ready(function() {
                $.get( "data/constellation_data.csv", function( data ) {
                    starData = $.csv.toArrays(data);
                    console.log("csv ready!");
                    
                    // splashscreen
                    $('.explore').click(function () {
                        $(this).parent('#splashscreen').fadeOut(500);
                    });
                    
                    //starData[1][7]
                    
                    init();
                });
            });

            function init(){
                if ( !Detector.webgl ) Detector.addGetWebGLMessage();
                scene = new THREE.Scene();

                //we need to see the world
                camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
                camera.position.set(0,10,100);

                //we need to update the display
                renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
         
                document.body.appendChild(renderer.domElement);
                
                //let there be light
                
                         var light	= new THREE.AmbientLight( 0x888888 );
	scene.add( light );
                
//                var light	= new THREE.DirectionalLight( 0xcccccc, 0.5 );
//	light.position.set(5,3,5);
//	scene.add( light );
                
                var light = new THREE.SpotLight( 0xCCCCCC, 1, 0, Math.PI, 1);
                light.position.set(20,50,50);
                scene.add(light);
                
                // earth woo
                geometry = new THREE.SphereGeometry(1, 30, 30);
                material = new THREE.MeshLambertMaterial( {color:0x0000ff});
                var earth = new THREE.Mesh(geometry, material);  
                earth.position.set(0, 0, 0);
                scene.add(earth);
                
                // map negative absolute magnitude ranges
                function map_range(value, low1, high1, low2, high2) {
                    return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
                }

                //draw spheres for each star in the constellation based off csv data
                geometry = new THREE.SphereGeometry(1, 30, 30);
                for (var i = 1; i < starData.length; i++) {
                    model = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({color:0x00ffff})); 
                    // map magnitude for brightness, parseFloat(starData[i][2])
                    
                    model.position.x = parseFloat(starData[i][4]) * 0.8; 
                    model.position.y = parseFloat(starData[i][5]) * 0.8;
                    model.position.z = parseFloat(starData[i][6]) * 0.8;
                    
                    // for magnitude, the more negative a number, the brighter
                    var invertedAbsoMag = -(parseFloat(starData[i][3]));
                    
                    // from asbolute magnitude, don't forget to change range values
                    var absoMag = map_range(invertedAbsoMag, -3.297647909, 2.304163211 , 0, 1.5);
                    
                    model.scale.set(absoMag,absoMag,absoMag);

                    scene.add(model);
                }

//                geometry = new THREE.SphereGeometry(0.5, 30, 30);
//                material = new THREE.MeshLambertMaterial( {color:0x00ffff});
//                var moon = new THREE.Mesh(geometry, material);  
//                moon.position.set(3, 5, 0);
//                scene.add(moon);
                
                geometry = new THREE.PlaneGeometry(50, 50, 1, 1);
                material = new THREE.MeshPhongMaterial( {color:0xCCCCCC,transparent: true,opacity: 0.5});
                var plane = new THREE.Mesh(geometry, material);
                plane.rotation.x = -Math.PI/2;
                plane.position.set (0, 0, 0);
                scene.add(plane);
                
                // camera controls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                
                render();
            }

            //render scene 60 fps
			function render() {
				requestAnimationFrame(render);

                camera.lookAt (scene.position);
                
				renderer.render(scene, camera);
                controls.update();
			}

		</script>
	</body>
</html>